import{e as f,j as e,r as j,u as N,a as v,b as y,P as k,f as D,g as S,h as T,i as I}from"./index-t1hGK_0_.js";import{u as g}from"./index.esm-CvpTHFiD.js";function F({setIsOpenUpdateForm:t,todo:l,updateTodoHandler:a}){const{userId:d}=f(),c=Number(d),{register:r,handleSubmit:m,watch:h,formState:{errors:s,isValid:p}}=g({mode:"onBlur",defaultValues:{id:l.id,title:l.title,description:l.description,isDone:l.isDone,userId:l.userId}}),u=n=>{n.description=n.description.trim(),n.title=n.title.trim(),c===n.userId&&n.userId&&n.description&&n.title&&(a(n.id,n.userId,n),t(!1))};return e.jsxs("form",{onSubmit:n=>{m(u)(n)},className:"p-3 border rounded-3 bg-light mb-3",children:[e.jsx("h5",{children:"Изменить задачу"}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"inputTitleUpd",className:"form-label w-100",children:["Название задачи*",e.jsx("input",{type:"text",className:`form-control ${s.title?"is-invalid":""}`,id:"inputTitleUpd",...r("title",{required:"Необходимо написать название",minLength:{value:1,message:"Минимум один символ"}})})]}),(s==null?void 0:s.title)&&e.jsx("div",{className:"invalid-feedback d-block",children:s.title.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"inputDescriptionUpd",className:"form-label w-100",children:["Описание задачи*",e.jsx("textarea",{className:`form-control ${s.description?"is-invalid":""}`,id:"inputDescriptionUpd",rows:4,...r("description",{required:"Необходимо добавить описание",minLength:{value:1,message:"Минимум один символ"},maxLength:{value:1e3,message:"Максимум 1000 символов"}})})]}),(s==null?void 0:s.description)&&e.jsx("div",{className:"invalid-feedback d-block",children:s.description.message})]}),e.jsx("div",{className:"form-check form-switch",children:e.jsxs("label",{className:"form-check-label",htmlFor:"isDoneSwitchUpd",children:[h("isDone")?"Задача выполнена":"Задача не выполнена",e.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"isDoneSwitchUpd",...r("isDone")})]})}),e.jsxs("div",{className:"d-flex justify-content-center gap-3",children:[e.jsx("button",{type:"submit",disabled:!p,className:"btn btn-outline-success",children:"Сохранить"}),e.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>t(!1),children:"Отменить"})]})]})}function L({todo:t,updateTodoHandler:l,deleteTodoHandler:a}){const[d,c]=j.useState(!1);return e.jsx("div",{className:"card mb-3 p-1",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h5",{className:"card-title",children:[e.jsx("span",{className:"fw-bold me-2",children:"Название:"})," ",t.title]}),e.jsxs("p",{className:"card-text",children:[e.jsx("span",{className:"fw-bold me-2",children:"Описание:"}),e.jsx("span",{style:{whiteSpace:"pre-line"},children:t.description})]}),e.jsxs("p",{className:"card-text",children:[e.jsx("span",{className:"fw-bold me-2",children:"Статус:"}),e.jsx("span",{className:`badge ${t.isDone?"bg-success":"bg-primary"}`,children:t.isDone?"Выполнена":"В работе"})]}),d?e.jsx(F,{todo:t,setIsOpenUpdateForm:c,updateTodoHandler:l}):e.jsxs("div",{className:"d-flex justify-content-center gap-3",children:[e.jsx("button",{type:"button",className:"btn btn-outline-warning",onClick:()=>c(!0),children:"Изменить задачу"}),e.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>a(t.id,t.userId),children:"Удалить задачу"})]})]})})}const U=j.memo(L);function C({addTodoHandler:t,setOpenAddForm:l}){const{userId:a}=f(),d=Number(a),{register:c,handleSubmit:r,reset:m,watch:h,formState:{errors:s,isValid:p,isSubmitting:u}}=g({mode:"onBlur",defaultValues:{title:"",isDone:!1,description:"",userId:d}}),n=o=>{const b={...o,title:o.title.trim(),description:o.description.trim(),userId:d};t(b.userId,b),m(),l(!1)};return e.jsxs("form",{onSubmit:o=>{r(n)(o)},className:"p-3 border rounded-3 bg-light mb-3",children:[e.jsx("h4",{className:"mb-4 text-center display-7",children:"Добавить новую задачу"}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"inputTitle",className:"form-label w-100 ",children:["Название задачи*",e.jsx("input",{type:"text",className:`form-control ${s.title?"is-invalid":""}`,id:"inputTitle",...c("title",{required:"Необходимо написать название",minLength:{value:1,message:"Минимум один символ"}})})]}),(s==null?void 0:s.title)&&e.jsx("div",{className:"invalid-feedback d-block",children:s.title.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"inputDescription",className:"form-label w-100",children:["Описание задачи*",e.jsx("textarea",{className:`form-control ${s.title?"is-invalid":""}`,id:"inputDescription",rows:4,...c("description",{required:"Необходимо добавить описание",minLength:{value:1,message:"Минимум один символ"},maxLength:{value:1e3,message:"Максимум 1000 символов"}})})]}),(s==null?void 0:s.description)&&e.jsx("div",{className:"invalid-feedback d-block",children:s.description.message})]}),e.jsx("div",{className:"form-check form-switch",children:e.jsxs("label",{className:"form-check-label",htmlFor:"isDoneSwitch",children:[h("isDone")?"Задача выполнена":"Задача не выполнена",e.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"isDoneSwitch",...c("isDone")})]})}),e.jsxs("div",{className:"d-flex justify-content-center gap-3 mt-3",children:[e.jsx("button",{type:"submit",disabled:!p||u,className:"btn btn-success flex-grow-1",children:"Создать"}),e.jsx("button",{type:"button",onClick:()=>l(!1),className:"btn btn-outline-secondary flex-grow-1",disabled:u,children:"Отменить"})]})]})}function $(){var b;const t=N(i=>i.todos),l=N(i=>i.user),a=v(),d=y(),[c,r]=j.useState(!1),[m,h]=j.useState("all-todos"),s=(i,x)=>{a(D({userId:i,data:x}))},p=(i,x,w)=>{a(S({todoId:i,userId:x,data:w}))},u=(i,x)=>{a(T({todoId:i,userId:x}))},n=i=>{h(i.target.value)},o=t.todos.filter(i=>{switch(m){case"active-todos":return!i.isDone;case"completed-todos":return i.isDone;default:return!0}});return t.isLoading?e.jsx(k,{}):((b=l.user)!=null&&b.id||d("/registration"),e.jsxs("div",{children:[e.jsx("div",{children:c?e.jsx(C,{addTodoHandler:s,setOpenAddForm:r}):e.jsxs("div",{children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary mb-3",onClick:()=>r(i=>!i),children:"Добавить задачу"}),e.jsx("div",{className:"mb-3",children:e.jsxs("select",{className:"form-select",value:m,onChange:n,children:[e.jsx("option",{value:"all-todos",children:"Все задачи"}),e.jsx("option",{value:"active-todos",children:"Активные задачи"}),e.jsx("option",{value:"completed-todos",children:"Завершенные задачи"})]})})]})}),o.length?e.jsx("div",{children:o.map(i=>e.jsx(U,{todo:i,updateTodoHandler:p,deleteTodoHandler:u},i.id))}):e.jsx("div",{children:"У вас еще нет задач"})]}))}function P(){const t=v(),{userId:l}=f();return j.useEffect(()=>{t(I(Number(l)))},[]),e.jsxs("div",{className:"container mt-3",children:[e.jsx("h1",{className:"display-6 mb-4",children:"Ваши задачи"}),e.jsx($,{})]})}export{P as default};
